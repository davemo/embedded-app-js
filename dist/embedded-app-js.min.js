/* embedded-app-js - 0.0.1
 * External JS file for use in Shopify embedded apps. Provides a JS API to postMessages to and from the Shopify admin.
 * https://github.com/shopify/embedded-app-js
 */
(function(){window.ShopifyApp=function(){function a(){}return a.debug=!1,a.forceRedirect=!0,a.apiKey="",a.shopOrigin="",a.setWindowLocation=function(a){return window.location=a},a.getWindowLocation=function(){return window.location},a.getWindowParent=function(){return window.parent},a.ready=function(b){return a.__addMessageHandler("Shopify.API.initialize",b)},a.init=function(b){var c=this;return null==b&&(b={}),this.loadConfig(b),this.checkFrame(),a.__addMessageHandler("Shopify.API.initialize",function(){return a.pushState(c.getWindowLocation().pathname+c.getWindowLocation().search)}),a.__addMessageHandler("Shopify.API.print",function(){return window.focus(),a.print()}),window.addEventListener?window.addEventListener("message",a.__addEventMessageCallback,!1):window.attachEvent("onMessage",a.__addEventMessageCallback)},a.checkFrame=function(){var b;return window===a.getWindowParent()?(b=""+(a.shopOrigin||"https://myshopify.com")+"/admin/apps/",a.apiKey&&(b=b+a.apiKey+a.getWindowLocation().pathname+(a.getWindowLocation().search||"")),a.forceRedirect?(a.log("ShopifyApp detected that it was not loaded in an iframe and is redirecting to: "+b,!0),a.setWindowLocation(b)):a.log("ShopifyApp detected that it was not loaded in an iframe but redirecting is disabled! Redirect URL would be: "+b,!0)):void 0},a.loadConfig=function(a){return this.apiKey=a.apiKey,this.shopOrigin=a.shopOrigin,this.forceRedirect=a.hasOwnProperty("forceRedirect")?!!a.forceRedirect:this.forceRedirect=!0,this.debug=!!a.debug,this.apiKey||this.log("ShopifyApp warning: apiKey has not been set."),this.shopOrigin||this.log("ShopifyApp warning: shopOrigin has not been set."),this.shopOrigin&&!this.shopOrigin.match(/^http(s)?:\/\//)?this.log("ShopifyApp warning: shopOrigin should include the protocol"):void 0},a.log=function(a,b){return("undefined"!=typeof console&&null!==console?console.log:void 0)&&(this.debug||b)?console.log(a):void 0},a.messageSlug=function(a){var b,c;for(b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=(a||"message")+"_",c=0;16>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},a.print=function(){return window.print()},a.window=function(){return this.getWindowParent().frames["app-iframe"]},a.postMessage=function(b,c){var d;return d=JSON.stringify({message:b,data:c}),a.log("ShopifyApp client sent "+d+" to "+this.shopOrigin),this.getWindowParent().postMessage(d,this.shopOrigin)},a.pushState=function(b){return a.postMessage("Shopify.API.pushState",{location:b})},a.flashError=function(b){return a.postMessage("Shopify.API.flash.error",{message:b})},a.flashNotice=function(b){return a.postMessage("Shopify.API.flash.notice",{message:b})},a.redirect=function(b){return a.postMessage("Shopify.API.redirect",{location:b})},a.Bar={initialize:function(b){return b=a.__addDefaultButtonMessages(b),a.__addButtonMessageHandlers(b),a.postMessage("Shopify.API.Bar.initialize",b)},loadingOn:function(){return a.postMessage("Shopify.API.Bar.loading.on")},loadingOff:function(){return a.postMessage("Shopify.API.Bar.loading.off")},setIcon:function(b){return a.postMessage("Shopify.API.Bar.icon",{icon:b})},setTitle:function(b){return a.postMessage("Shopify.API.Bar.title",{title:b})},setPagination:function(b){var c;return c=a.__addDefaultButtonMessages({pagination:b}),a.__addButtonMessageHandlers(c),a.postMessage("Shopify.API.Bar.pagination",c)}},a.Modal={__callback:void 0,__open:function(b,c,d){return a.Modal.__callback=d,a.postMessage(b,c)},window:function(){return a.getWindowParent().frames["app-modal-iframe"]},open:function(b,c){return b=a.__addDefaultButtonMessages(b),a.__addButtonMessageHandlers(b,!0),a.Modal.__open("Shopify.API.Modal.open",b,c)},alert:function(b,c){return a.Modal.__open("Shopify.API.Modal.alert",{message:b},c)},confirm:function(b,c){return a.Modal.__open("Shopify.API.Modal.confirm",{message:b},c)},input:function(b,c){return a.Modal.__open("Shopify.API.Modal.input",{message:b},c)},close:function(b,c){return a.postMessage("Shopify.API.Modal.close",{result:b,data:c})}},a.__messageHandlers={},a.__modalMessages=[],a.__addDefaultButtonMessages=function(b){var c,d,e,f,g,h,i;if(null!=b.primaryButton&&(b.primaryButton.message||(b.primaryButton.message=a.messageSlug("primaryButton"))),null!=b.buttons)for(g=b.buttons,d=e=0,f=g.length;f>e;d=++e)c=g[d],c.message||(c.message=a.messageSlug("button"+d));return null!=(null!=(h=b.pagination)?h.previous:void 0)&&(b.pagination.previous.message||(b.pagination.previous.message=a.messageSlug("pagination_previous")),b.pagination.previous.href&&(b.pagination.previous.target="app")),null!=(null!=(i=b.pagination)?i.next:void 0)&&(b.pagination.next.message||(b.pagination.next.message=a.messageSlug("pagination_next")),b.pagination.next.href&&(b.pagination.next.target="app")),b},a.__addButtonMessageHandlers=function(b,c){var d,e,f,g,h,i;if(null!=b.primaryButton&&a.__addButtonMessageHandler(b.primaryButton,c),null!=b.buttons)for(g=b.buttons,e=0,f=g.length;f>e;e++)d=g[e],a.__addButtonMessageHandler(d,c);return null!=(null!=(h=b.pagination)?h.previous:void 0)&&a.__addButtonMessageHandler(b.pagination.previous,c),null!=(null!=(i=b.pagination)?i.next:void 0)?a.__addButtonMessageHandler(b.pagination.next,c):void 0},a.__addButtonMessageHandler=function(b,c){var d=this;return b.action&&(this.log("DEPRECATION: Button 'action' is being removed and has been replaced with 'callback'.",!0),b.callback||(b.callback=b.action)),"app"===b.target&&(b.callback=function(){return d.setWindowLocation(b.href)}),"function"==typeof b.callback?a.__addMessageHandler(b.message,b.callback,c):void 0},a.__addMessageHandler=function(b,c,d){return"function"==typeof b&&(c=b,b=void 0),a.__messageHandlers[b]||(a.__messageHandlers[b]=[]),d&&a.__modalMessages.push(b),a.__messageHandlers[b].push(c)},a.__clearModalListeners=function(){return a.__modalMessages.forEach(function(b){return delete a.__messageHandlers[b]}),a.__modalMessages=[]},a.__addEventMessageCallback=function(b){var c,d,e,f,g,h;if(b.origin!==a.shopOrigin)return a.log("ShopifyApp client received "+b.data+" from unknown origin "+b.origin+". Expected "+a.shopOrigin+".");for(a.log("ShopifyApp client received "+b.data+" from "+b.origin),e=JSON.parse(b.data),"Shopify.API.Modal.close"===e.message&&a.Modal.__callback&&(a.__clearModalListeners(),a.Modal.__callback(e.data.result,e.data.data)),d=[],a.__messageHandlers[e.message]&&(d=d.concat(a.__messageHandlers[e.message])),a.__messageHandlers[void 0]&&(d=d.concat(a.__messageHandlers[void 0])),g=0,h=d.length;h>g;g++)c=d[g],c(e.message,e.data);(f=document.querySelector('form[data-shopify-app-submit="'+e.message+'"]'))&&f.submit()},a}.call(this)}).call(this);